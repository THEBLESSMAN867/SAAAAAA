{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://saaaaaa.policy.analysis/schemas/report_assembly/macro_convergence.schema.json",
  "title": "MacroLevelConvergence",
  "description": "Convergencia de nivel MACRO que proporciona evaluación ejecutiva completa del plan con alineación al Decálogo, análisis de brechas críticas y hoja de ruta de implementación",
  "type": "object",
  "required": [
    "overall_score",
    "convergence_by_dimension",
    "convergence_by_policy_area",
    "gap_analysis",
    "agenda_alignment",
    "critical_gaps",
    "strategic_recommendations",
    "plan_classification"
  ],
  "properties": {
    "overall_score": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 100.0,
      "description": "Puntuación global del plan (0-100 escala porcentual)"
    },
    "convergence_by_dimension": {
      "type": "object",
      "description": "Convergencia por dimensión analítica (D1-D6) en escala porcentual",
      "required": ["D1", "D2", "D3", "D4", "D5", "D6"],
      "properties": {
        "D1": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Diagnóstico y Recursos"},
        "D2": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Diseño de Intervención"},
        "D3": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Productos y Outputs"},
        "D4": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Resultados y Outcomes"},
        "D5": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Impactos de Largo Plazo"},
        "D6": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Teoría de Cambio y Coherencia Causal"}
      },
      "additionalProperties": false
    },
    "convergence_by_policy_area": {
      "type": "object",
      "description": "Convergencia por área de política del Decálogo (P1-P10) en escala porcentual",
      "required": ["P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "P9", "P10"],
      "properties": {
        "P1": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Derechos de las mujeres e igualdad de género"},
        "P2": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Prevención de la violencia y protección frente al conflicto"},
        "P3": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Ambiente sano, cambio climático"},
        "P4": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Derechos económicos, sociales y culturales"},
        "P5": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Derechos de las víctimas y construcción de paz"},
        "P6": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Niñez, adolescencia y juventud"},
        "P7": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Tierras y territorios"},
        "P8": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Líderes y defensores de derechos humanos"},
        "P9": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Personas privadas de la libertad"},
        "P10": {"type": "number", "minimum": 0.0, "maximum": 100.0, "description": "Migración transfronteriza"}
      },
      "additionalProperties": false
    },
    "gap_analysis": {
      "type": "object",
      "description": "Análisis exhaustivo de brechas identificadas",
      "properties": {
        "critical_gaps": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["gap_id", "description", "severity", "affected_areas"],
            "properties": {
              "gap_id": {"type": "string"},
              "description": {"type": "string", "minLength": 20, "maxLength": 1000},
              "severity": {"type": "string", "enum": ["critical", "high", "medium", "low"]},
              "affected_areas": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Áreas afectadas (P#-D#)"
              },
              "estimated_impact": {
                "type": "number",
                "minimum": 0.0,
                "maximum": 1.0,
                "description": "Impacto estimado en el score global"
              },
              "remediation_cost": {
                "type": "string",
                "enum": ["high", "medium", "low", "negligible"]
              },
              "remediation_time": {
                "type": "string",
                "enum": ["immediate", "short_term", "medium_term", "long_term"]
              }
            },
            "additionalProperties": false
          },
          "description": "Brechas críticas identificadas",
          "maxItems": 100
        },
        "missing_elements": {
          "type": "object",
          "description": "Elementos faltantes por dimensión",
          "patternProperties": {
            "^D[1-6]$": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "insufficient_elements": {
          "type": "object",
          "description": "Elementos insuficientes por dimensión",
          "patternProperties": {
            "^D[1-6]$": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "element": {"type": "string"},
                  "current_level": {"type": "string"},
                  "required_level": {"type": "string"},
                  "gap_size": {"type": "number"}
                }
              }
            }
          }
        }
      },
      "additionalProperties": true
    },
    "agenda_alignment": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Alineación con la agenda del Decálogo (0.0=sin alineación, 1.0=completamente alineado)"
    },
    "critical_gaps": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 10,
        "maxLength": 500
      },
      "description": "Lista de brechas críticas que requieren atención inmediata",
      "maxItems": 50
    },
    "strategic_recommendations": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["priority", "recommendation", "rationale"],
        "properties": {
          "priority": {
            "type": "integer",
            "minimum": 1,
            "description": "Prioridad de la recomendación (1=más alta)"
          },
          "recommendation": {
            "type": "string",
            "minLength": 20,
            "maxLength": 2000,
            "description": "Texto de la recomendación estratégica"
          },
          "rationale": {
            "type": "string",
            "minLength": 20,
            "maxLength": 1000,
            "description": "Justificación de la recomendación"
          },
          "affected_areas": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Áreas afectadas por la recomendación"
          },
          "expected_impact": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 100.0,
            "description": "Impacto esperado en el score (puntos porcentuales)"
          },
          "implementation_complexity": {
            "type": "string",
            "enum": ["low", "medium", "high", "very_high"]
          },
          "timeline": {
            "type": "string",
            "description": "Timeline de implementación (e.g., '1-3 meses')"
          },
          "responsible_entity": {
            "type": "string",
            "description": "Entidad responsable de la implementación"
          }
        },
        "additionalProperties": false
      },
      "description": "Recomendaciones estratégicas de alto nivel priorizadas",
      "maxItems": 50
    },
    "plan_classification": {
      "type": "string",
      "enum": ["EXCELENTE", "BUENO", "SATISFACTORIO", "INSUFICIENTE", "DEFICIENTE"],
      "description": "Clasificación global del plan según rúbrica"
    },
    "evidence_synthesis": {
      "type": "object",
      "description": "Síntesis de evidencia consolidada",
      "properties": {
        "total_evidence_pieces": {
          "type": "integer",
          "minimum": 0,
          "description": "Total de piezas de evidencia recopiladas"
        },
        "evidence_by_dimension": {
          "type": "object",
          "patternProperties": {
            "^D[1-6]$": {"type": "integer"}
          }
        },
        "evidence_quality_distribution": {
          "type": "object",
          "properties": {
            "high_quality": {"type": "integer"},
            "medium_quality": {"type": "integer"},
            "low_quality": {"type": "integer"}
          }
        },
        "primary_sources_count": {
          "type": "integer",
          "description": "Número de fuentes primarias citadas"
        },
        "executive_summary": {
          "type": "string",
          "minLength": 500,
          "maxLength": 5000,
          "description": "Síntesis ejecutiva de 500-1000 palabras"
        }
      },
      "additionalProperties": true
    },
    "implementation_roadmap": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["phase", "actions", "timeline", "milestones"],
        "properties": {
          "phase": {
            "type": "string",
            "description": "Nombre de la fase (e.g., 'Fase 1: Fundación')"
          },
          "description": {
            "type": "string",
            "minLength": 20,
            "maxLength": 1000
          },
          "actions": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 10,
              "maxLength": 500
            },
            "description": "Acciones específicas en esta fase"
          },
          "timeline": {
            "type": "string",
            "description": "Timeline de la fase (e.g., 'Meses 1-3')"
          },
          "milestones": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "milestone": {"type": "string"},
                "target_date": {"type": "string"},
                "success_criteria": {"type": "string"}
              }
            }
          },
          "responsible_entities": {
            "type": "array",
            "items": {"type": "string"}
          },
          "dependencies": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Dependencias de otras fases"
          }
        },
        "additionalProperties": false
      },
      "description": "Hoja de ruta de implementación por fases",
      "maxItems": 10
    },
    "score_distribution": {
      "type": "object",
      "description": "Distribución de puntuaciones a través del plan",
      "properties": {
        "EXCELENTE": {"type": "integer", "minimum": 0, "description": "Número de respuestas EXCELENTE"},
        "BUENO": {"type": "integer", "minimum": 0, "description": "Número de respuestas BUENO"},
        "ACEPTABLE": {"type": "integer", "minimum": 0, "description": "Número de respuestas ACEPTABLE"},
        "INSUFICIENTE": {"type": "integer", "minimum": 0, "description": "Número de respuestas INSUFICIENTE"}
      },
      "additionalProperties": false
    },
    "confidence_metrics": {
      "type": "object",
      "description": "Métricas de confianza global",
      "properties": {
        "avg_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Confianza promedio en las evaluaciones"
        },
        "min_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "max_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "confidence_std_dev": {
          "type": "number",
          "minimum": 0.0
        },
        "high_confidence_percentage": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 100.0,
          "description": "Porcentaje de evaluaciones con confianza ≥ 0.8"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Metadatos del análisis MACRO",
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "analysis_version": {
          "type": "string",
          "description": "Versión del sistema de análisis"
        },
        "total_questions_analyzed": {
          "type": "integer",
          "minimum": 0
        },
        "total_modules_executed": {
          "type": "integer",
          "minimum": 0
        },
        "total_processing_time_seconds": {
          "type": "number",
          "minimum": 0.0
        },
        "document_metadata": {
          "type": "object",
          "properties": {
            "document_id": {"type": "string"},
            "document_title": {"type": "string"},
            "municipality": {"type": "string"},
            "year": {"type": "integer"},
            "administration_period": {"type": "string"}
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://saaaaaa.policy.analysis/schemas/report_assembly/meso_cluster.schema.json",
  "title": "MesoLevelCluster",
  "description": "Agregación de nivel MESO que consolida preguntas relacionadas en clusters temáticos para análisis de nivel medio con evaluación de fortalezas/debilidades",
  "type": "object",
  "required": [
    "cluster_name",
    "cluster_description",
    "policy_areas",
    "avg_score",
    "dimension_scores",
    "strengths",
    "weaknesses",
    "recommendations",
    "question_coverage",
    "total_questions",
    "answered_questions"
  ],
  "properties": {
    "cluster_name": {
      "type": "string",
      "pattern": "^CLUSTER_\\d+$",
      "description": "Identificador del cluster (CLUSTER_1, CLUSTER_2, etc.)",
      "examples": ["CLUSTER_1", "CLUSTER_10"]
    },
    "cluster_description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Descripción textual del cluster temático"
    },
    "policy_areas": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^P(\\d|10)$",
        "description": "Área de política del Decálogo (P1-P10)"
      },
      "description": "Áreas de política incluidas en el cluster",
      "minItems": 1,
      "maxItems": 10,
      "uniqueItems": true
    },
    "avg_score": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 100.0,
      "description": "Puntuación promedio del cluster (0-100 escala porcentual)"
    },
    "dimension_scores": {
      "type": "object",
      "description": "Puntuaciones por dimensión analítica (D1-D6) en escala porcentual",
      "properties": {
        "D1": {"type": "number", "minimum": 0.0, "maximum": 100.0},
        "D2": {"type": "number", "minimum": 0.0, "maximum": 100.0},
        "D3": {"type": "number", "minimum": 0.0, "maximum": 100.0},
        "D4": {"type": "number", "minimum": 0.0, "maximum": 100.0},
        "D5": {"type": "number", "minimum": 0.0, "maximum": 100.0},
        "D6": {"type": "number", "minimum": 0.0, "maximum": 100.0}
      },
      "additionalProperties": false
    },
    "strengths": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 10,
        "maxLength": 500
      },
      "description": "Fortalezas identificadas en el cluster",
      "maxItems": 50
    },
    "weaknesses": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 10,
        "maxLength": 500
      },
      "description": "Debilidades identificadas en el cluster",
      "maxItems": 50
    },
    "recommendations": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 20,
        "maxLength": 1000
      },
      "description": "Recomendaciones estratégicas para el cluster",
      "maxItems": 30
    },
    "question_coverage": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 100.0,
      "description": "Porcentaje de preguntas respondidas en el cluster"
    },
    "total_questions": {
      "type": "integer",
      "minimum": 1,
      "description": "Total de preguntas en el cluster"
    },
    "answered_questions": {
      "type": "integer",
      "minimum": 0,
      "description": "Número de preguntas respondidas"
    },
    "evidence_quality": {
      "type": "object",
      "description": "Calidad de la evidencia por dimensión o categoría",
      "patternProperties": {
        "^.+$": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      }
    },
    "cluster_statistics": {
      "type": "object",
      "description": "Estadísticas agregadas del cluster",
      "properties": {
        "score_variance": {
          "type": "number",
          "minimum": 0.0,
          "description": "Varianza de las puntuaciones en el cluster"
        },
        "score_std_dev": {
          "type": "number",
          "minimum": 0.0,
          "description": "Desviación estándar de las puntuaciones"
        },
        "median_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 100.0,
          "description": "Mediana de las puntuaciones"
        },
        "min_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 100.0,
          "description": "Puntuación mínima"
        },
        "max_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 100.0,
          "description": "Puntuación máxima"
        },
        "quartiles": {
          "type": "array",
          "items": {"type": "number"},
          "minItems": 3,
          "maxItems": 3,
          "description": "Cuartiles [Q1, Q2, Q3]"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Metadatos adicionales del cluster",
      "properties": {
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "source_questions": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^P(\\d|10)-D[1-6]-Q[1-5]$"
          },
          "description": "IDs de las preguntas incluidas en el cluster"
        },
        "aggregation_method": {
          "type": "string",
          "enum": ["weighted_average", "simple_average", "median"],
          "description": "Método de agregación usado"
        },
        "dimension_weights": {
          "type": "object",
          "description": "Pesos aplicados por dimensión en la agregación",
          "patternProperties": {
            "^D[1-6]$": {"type": "number", "minimum": 0.0, "maximum": 1.0}
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
